# Задание №4

## Подготовка

Согласно заданию, я настроил локальный мониторинг с помощью NewRelic, SkyLight (который уже используется в проекте) и
подключил DIY (если можно так назвать сборку нескольких готовых решений в кучу) мониторинг с помощью связки Prometheus + Grafana.
Для этого понадобилось установить Графану на свою машину, настроить ее, добавить запуск Прометеуса в Procfile и немного настроить его.
Выгрузку метрик и дашборд в Графане сделал с помощью гема yabeda-rails, который внутри использует prometheus-exporter
и плагина для Графаны Yabeda Rails. Так же установил в проект rack-mini-profiler и rails panel для Хрома.

## local_production

Для начала надо определиться, какой выбрать путь — сделать отдельный энв, либо использовать production, но переопределить
его настройки для локального запуска. Посмотрим, много ли в коде завязок на production енв.

```
$ grep -IR 'Rails\.env\.production?' ./*/** | wc -l
31
```

Вхождений много, но если посмотреть на контекст использования в большинстве случаев, то становится понятно, что для наших целей
(профилирования приложения) лучше будет все таки сделать отдельный энв.
`$ grep -c=5 -IR 'Rails\.env\.production?' ./*/**`

Исключим новое окружение в настройках Airbrake:
`c.ignore_environments = %w[test development local_production]`

Добавим новое окружение в `newrelic.yml`, `webpacker.yml` и `secrets.yml`. Настройки опишем в новом файле
`config/environments/local_production.rb`. Чтобы запускать новый энв заведем `Procfile.local_prod` и `bin/local_prod_startup`
по аналогии с другими вариантами запуска.

## Оптимизация
