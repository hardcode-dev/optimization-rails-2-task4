# Case Study

## Подготовительные работы

- [x] Завести `dev.to` локально (прямо в этом репозитории, не нужно клонировать `dev.to` от них, иначе будут отличаться версии)
- [x] Настроить свой `NewRelic` для мониторинга локального `dev.to`
- [x] Настроить свой `Skylight` для мониторинга локального `dev.to`
- [x] Настроить свой `Prometheus` + `Grafana` для мониторинга локального `dev.to`
- [x] Настроить `rack-mini-profiler`
- [x] Настроить `rails-panel`
- [x] Сделать возможность запуска проекта в `local_production`

## Оптимизация

Все инструменты мониторинга показывают, что самой горячей точкой является главная страница, `StoriesController#index`.

В частности, заметное время занимает рендеринг `partial`-ов `_single_story.html.erb`.

### Оптимизация

Рассмотрел гипотезу о том, что можно закешировать `<%= render "articles/single_story", story: story %>` в `_main_stories_feed.html.erb` и это даст заметный эффект.

Как метрику выбрал `Time per request` в `ab` (30 запросов)

**Замер ДО (с помощью AB)** - Time per request: 450.241 [ms](mean)

Закэшировал `story` перед передачей в сам паршл просто добавив `<% cache story do %> ... <% end %>`.
В итоге в `rmp` сильно уменшьшилось количество паршелов, метрика тоже улучшилась.

**Замер ПОСЛЕ (с помощью AB)** - Time per request: 268.976 [ms](mean)

## Итоги

- Главным итогом данной работы считаю то, что удалось попрактиковаться с инструментами анализа и мониторинга. Нет сомнений, что смогу использовать в работе.
- Также был интересен подход с реализацией `local_production`, думаю, что буду пробовать на своих проектах.
- По поводу кеширования понял, что знаний и опыта мало, надо дополнительно изучить тему.
