## Задача - оптимизировать rake reload_json[fixtures/large.json] так, чтобы он выполнялся менее, чем за 60 секунд.

===============
25.02.2020
Развернул проект, интегрировал с new relic, skylight, rack-mini-profiler и rails-panel. Но вот prometheus и Graphana у меня что-то не взлетели.

`prometheus_1 | time="2020-02-25T15:19:51Z" level=error msg="Couldn't load configuration (-config.file=/prometheus.yml): read /prometheus.yml: is a directory" source="main.go:214" rails-optimization-task4_prometheus_1 exited with code 1`

думаю, пока без него буду оптимизировать

================
26.02.2020
Построим фидбэк луп и изучим, как дела обстоят с загрузкой индекс страницы (root "stories#index")
Судя по логам, из одного контроллера запрос перенаправляется и в другие тоже. И сложно разобрать, какой из них, сколько времени на самом деле занимает

rack-mini-profiler также показывает несколько запросов, начнем с самого тяжелого из них, 5_776 ms:

`GET http://localhost:3000/yundt_lucy/-dulce-e... 60.7 +0.0 Executing action: show 419.0 +52.0 11 sql 55.5 Rendering: articles/show 4774.6 +471.0 8 sql 27.3 Rendering: articles/_actions 26.2 +5129.0 Rendering: articles/_full_comment_area 11.1 +5170.0 Rendering: comments/_form 15.7 +5176.0 Rendering: articles/_comments_actions 6.6 +5197.0 Rendering: articles/_bottom_content 375.5 +5272.0 7 sql 21.4 Rendering: articles/_sticky_nav 84.8 +5654.0 2 sql 4.0`

Попробуем запрофилировать этот экшн в callgrind, чтобы понять, какой из используемых им методов потребляет больше всего времени. Для этого сделаем local_production окружение
Настроил local_production окружение, проверил - страницы открываются вроде без ошибок.

Но stackprof у меня не открывает отчеты (хоть и генерирует), а callgrind в локал_прод окружении почему то 500 завершает работу. Хотя отчеты генерирует. А в дев среде отрабатывает нормально. Завтра буду разбираться, в чем дело.

================
28.02.2020
Каким то образом оказался покалечен webpacker, починил его и производные, а в local_production окружении настройку config.public_file_server выставил как девелопменте, теперь удалось запустить профилировщик внутри контроллера. Отчет 54883 показывает, что 25% времени уходит на какой-то <cycle 2>, в котором все выглядит, как рельсовая инфраструктура, и еще 25% времени съедает PG Connection. Вообще в рамках этого контроллера выполняется чересчур много вызовов, мне кажется, если убрать эту вложенную цикличность, то удастся сократить время выполнения экшна. Ну и запросы к базе тоже проанализировать надо будет завтра
